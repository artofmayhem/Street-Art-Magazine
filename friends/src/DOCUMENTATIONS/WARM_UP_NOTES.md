OBJECTIVES

1. handle authentication tokens in a react app

generally servers don't remember anything about visitors after each interaction. Clients need to tack a reminder to every request. This is done generally with cookies

Cookie - small piece of data generated by the browser to store state information

modern web services dealing in JSON data often use Jason Web Tokens (JWT's) instead. 

JWT's are...
**generated by the server**
**strings of cryptic text**
**can be stored on the client side localStorage or session storage**

the server can tell the client that a token has been issues. it can also read and make decisions of data transfer based on the client's permission

common practice is for login endpoint to exist. taking a payload or userName and Password. if credentials are known the server responds with a fresh JWT. at this point the applications responsibility to add an Authorization: <token> header to every request for the purpose of allowing access to protected resources that require authentication

We are going to create an Axios configuration that attaches an Authorization: <token> header to requests. To do that, we will create a new file called axiosAuth.js. Whenever the application needs to exchange data with a protected endpoint, it imports this module, instead of the usual import axios from "axios";.

**
import axios from 'axios';

export const axiosWithAuth =() => {
    const token = localStorage.getItem('token');

    return axios.create({
        headers: {
            Authorization: token,
        },
    });
};
**

Note: Some API's require you to use a slightly different syntax. Make sure you understand the API you are working with

Authorization: `Bearer ${token}`,

After the user properly authenticates (properly logs in), the server returns the token. Your application needs to save the returned token (the permissions) to localStorage, so that the above axiosWithAuth module can grab it for other calls that require the Authorization header.

const login = () => {
  axios.post('endpoint/here', userCredentials)
    .then(res => {
      localStorage.setItem('token', res.data.token);
      props.history.push('/dashboard');
    }
}

Now that we have the token, we can do an AJAX request to an endpoint using the axiosWithAuth.js module

  import { axiosWithAuth } from '../../path/to/axiosAuth.js';
  // etc
  axiosWithAuth().get('endpoint/path/here').then(data => /* do something with the data */);

  2. Implement protected routes using an authentication token and redirect

  We are going to build a protected route

  function App() {
  return (
    <div>
      <ul>
        <li>
          <Link to="/public">Public Page</Link>
        </li>
        <li>
          <Link to="/protected">Protected Page</Link>
        </li>
      </ul>
      <Route path="/public" component={Public} />
      <Route path="/login" component={Login} />
      <PrivateRoute path='/protected' component={Protected} />
    </div>
  );
}

rules for private routes

* has the same api as <Route /> 
* renders <Route /> and passes all props to it
* checks the users authentication. if authenticated it renders component Prop. If not redirects to login screen. 

// Requirement 1.
// It has the same API as `<Route />`

const PrivateRoute = ({ component: Component, ...rest }) => (


// Requirement 2.
// It renders a `<Route />` and passes all the props through to it.

const PrivateRoute = ({ component: Component, ...rest }) => (
  <Route {...rest} render={} />
)

// Requirement 3.
// It checks if the user is authenticated, if they are,
// it renders the "component" prop. If not, it redirects
// the user to /login.

const PrivateRoute = ({ component: Component, ...rest }) => (
  <Route
    {...rest}
    render={props =>
      localStorage.getItem("token") ? (
        <Component {...props} />
      ) : (
        <Redirect to="/login" />
      )
    }
  />
);


AND FINALLY 

import React, { useState } from 'react';
import { axiosWithAuth } from '../path/to/module';

const Login = (props) => {
 const [credentials, setCredentials] = useState({});

  const login = e => {
    e.preventDefault();
    axiosWithAuth().post('login/endpoint', credentials)
      .then(res => {
        localStorage.setItem('token', res.data.token);
        this.props.history.push('/');
      })
  }

  const handleChange = e => {
      setCredentials: {
        ...credentials,
        [e.target.name]: e.target.value,
      }
  }

    return (
      <div>
        <form onSubmit={this.login}>
          <input
            type="text"
            name="username"
            value={credentials.username}
            onChange={this.handleChange}
          />
          <input
            type="password"
            name="password"
            value={credentials.password}
            onChange={this.handleChange}
          />
          <button>Log in</button>
        </form>
      </div>
    )
}

export default Login;